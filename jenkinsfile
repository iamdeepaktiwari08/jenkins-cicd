pipeline {
    agent any

    stages {
        stage('Build Docker Image') {
            steps {
                sh '''
                    # Purana container hatao (agar chal raha ho)
                    docker rm -f $(docker ps -aq) || true
                    
                    # Naya image build karo
                    docker build --no-cache -t new .
                '''
            }
        }

        stage('Run Docker Container') {
            steps {
                sh '''
                    # Naya container run karo
                    docker run -d -p 80:80 --name website new
                '''
            }
        }

        stage('Test Website') {
            steps {
                sh '''
                    echo "Testing website..."
                    curl -s http://192.168.77.137 | grep "Jai Shri Ram" || exit 1
                '''
            }
        }
    }
}
